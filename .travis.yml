#
#  Licensed to the Apache Software Foundation (ASF) under one or more
#  contributor license agreements.  See the NOTICE file distributed with
#  this work for additional information regarding copyright ownership.
#  The ASF licenses this file to You under the Apache License, Version 2.0
#  (the "License"); you may not use this file except in compliance with
#  the License.  You may obtain a copy of the License at
#
#       http://www.apache.org/licenses/LICENSE-2.0
#
#  Unless required by applicable law or agreed to in writing, software
#  distributed under the License is distributed on an "AS IS" BASIS,
#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#  See the License for the specific language governing permissions and
#  limitations under the License.
#
language: java

matrix:
  include:

    - name: "OS X / Java 11 / OpenSSL 1.1.x"
      os: osx
      osx_image: xcode9.3
      jdk: oraclejdk11
      env:
        - JAVA_HOME=$(/usr/libexec/java_home)

before_install:
  - |
    curl -L --cookie 'oraclelicense=accept-securebackup-cookie;' http://download.oracle.com/otn-pub/java/jce/8/jce_policy-8.zip -o /tmp/policy.zip
    sudo unzip -j -o /tmp/policy.zip *.jar -d $JAVA_HOME/jre/lib/security
    rm /tmp/policy.zip
  - brew update
  - brew install openssl@1.1 --force
  - export PATH="/usr/local/opt/openssl@1.1/bin:$PATH" >> ~/.bash_profile
  - export LDFLAGS="-L/usr/local/opt/openssl@1.1/lib"
  - export CPPFLAGS="-I/usr/local/opt/openssl@1.1/include"
  - openssl version -a
  - ls -la /usr/local/lib
install: mvn install -DskipTests=true -Dmaven.javadoc.skip=true -B -V
script: mvn test jacoco:report coveralls:report -B -V
after_success: mvn site -B -V

cache:
  directories:
    - $HOME/.m2
